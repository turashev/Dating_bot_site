<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#ff4757" />
  <title>EvilCorp: –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* ==========================================================
       EvilCorp ‚Äî Single-file demo (HTML/CSS/JS)
       ========================================================== */

    /* RESET */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      overflow-x: hidden;
      transition: background .35s ease, color .25s ease;
    }
    button, input, select, textarea { font: inherit; }
    a { color: inherit; text-decoration: none; }

    :root {
      --primary: #FF4757;
      --primary-hover: #ff6b81;
      --secondary: #5352ed;
      --accent: #2ed573;
      --warning: #ffa502;

      --bg-body: #f2f4fb;
      --bg-card: #ffffff;
      --bg-glass: rgba(255,255,255,.78);
      --bg-input: #f7f9ff;

      --text-main: #1f2330;
      --text-sub: #6c7486;
      --text-light: #a4adbd;

      --radius-xl: 28px;
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-sm: 12px;

      --shadow-sm: 0 4px 10px rgba(0,0,0,.06);
      --shadow-md: 0 10px 24px rgba(0,0,0,.08);
      --shadow-lg: 0 24px 60px rgba(0,0,0,.12);
      --backdrop: blur(18px);

      --ease: cubic-bezier(.2,.9,.2,1);
      --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);

      --gradient-primary: linear-gradient(135deg, #FF4757 0%, #ff6b81 100%);
      --gradient-super: linear-gradient(135deg, #3742fa 0%, #5352ed 100%);
    }

    [data-theme="dark"] {
      --bg-body: #0f111a;
      --bg-card: #1b1f2c;
      --bg-glass: rgba(27,31,44,.78);
      --bg-input: #2a2f42;

      --text-main: #ffffff;
      --text-sub: #a9b2c6;
      --text-light: #65708b;

      --shadow-sm: 0 4px 10px rgba(0,0,0,.35);
      --shadow-md: 0 10px 24px rgba(0,0,0,.45);
      --shadow-lg: 0 24px 60px rgba(0,0,0,.55);
    }

    /* Background orbs */
    body::before, body::after {
      content: "";
      position: fixed;
      width: 520px;
      height: 520px;
      border-radius: 50%;
      filter: blur(90px);
      opacity: .18;
      z-index: -1;
      animation: floatBg 18s ease-in-out infinite alternate;
    }
    body::before { background: var(--primary); top: -12%; left: -12%; }
    body::after { background: var(--secondary); bottom: -12%; right: -12%; animation-delay: -8s; }

    @keyframes floatBg {
      0% { transform: translate(0,0) scale(1); }
      50% { transform: translate(40px,-30px) scale(1.06); }
      100% { transform: translate(-30px,25px) scale(1); }
    }

    @keyframes slideUpFade {
      from { opacity: 0; transform: translateY(18px) scale(.99); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes popIn {
      0% { transform: scale(.6); opacity: 0; }
      70% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes pulseGlow {
      0% { box-shadow: 0 0 0 0 rgba(255,71,87,.4); }
      70% { box-shadow: 0 0 0 16px rgba(255,71,87,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,71,87,0); }
    }

    /* GIFT ANIMATION CSS */
    @keyframes giftMainPop {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-45deg); opacity: 0; }
      40% { transform: translate(-50%, -50%) scale(1.8) rotate(10deg); opacity: 1; }
      60% { transform: translate(-50%, -50%) scale(1.6) rotate(-5deg); opacity: 1; }
      100% { transform: translate(-50%, -150%) scale(2) rotate(0deg); opacity: 0; }
    }

    @keyframes particleFly {
      0% { transform: translate(0, 0) scale(0.5); opacity: 1; }
      100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
    }

    .gift-anim-container {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      z-index: 9999;
      pointer-events: none;
    }

    .gift-anim-main {
      position: absolute;
      font-size: 80px;
      left: 0;
      top: 0;
      filter: drop-shadow(0 15px 30px rgba(0,0,0,0.3));
      animation: giftMainPop 1.8s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    }

    .gift-particle {
      position: absolute;
      left: 0;
      top: 0;
      font-size: 20px;
      animation: particleFly 1.2s ease-out forwards;
    }

    .container {
      max-width: 1320px;
      margin: 0 auto;
      padding: 18px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* HEADER */
    header {
      position: sticky;
      top: 12px;
      z-index: 50;
      background: var(--bg-glass);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: var(--backdrop);
      -webkit-backdrop-filter: var(--backdrop);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      padding: 14px 16px;
      animation: slideUpFade .7s var(--ease);
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 900;
      letter-spacing: -.02em;
      font-size: 20px;
      cursor: pointer;
      user-select: none;
      transition: transform .25s var(--ease);
    }
    .logo span {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      background: var(--gradient-primary);
      color: #fff;
      box-shadow: 0 10px 25px rgba(255,71,87,.25);
    }
    .logo:hover { transform: translateY(-2px); }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: var(--bg-input);
      border: 1px solid rgba(0,0,0,.05);
      color: var(--text-main);
      box-shadow: var(--shadow-sm);
      transition: transform .25s var(--ease), box-shadow .25s var(--ease);
    }
    [data-theme="dark"] .pill { border-color: rgba(255,255,255,.06); }
    .pill:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      background: var(--bg-input);
      box-shadow: var(--shadow-sm);
      transition: transform .25s var(--ease-elastic), filter .25s var(--ease);
    }
    .icon-btn:hover { transform: rotate(8deg) scale(1.08); filter: brightness(1.02); }
    .icon-btn:active { transform: scale(.92); }

    .theme-toggle::after { content: "üåô"; font-size: 18px; }
    [data-theme="dark"] .theme-toggle::after { content: "‚òÄÔ∏è"; }

    .lang-toggle::after { content: "KZ"; font-weight: 900; }
    [data-lang="kz"] .lang-toggle::after { content: "RU"; }

    nav {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .nav-btn {
      position: relative;
      border: none;
      cursor: pointer;
      padding: 10px 14px;
      border-radius: 999px;
      background: transparent;
      color: var(--text-sub);
      font-weight: 700;
      transition: all .25s var(--ease);
    }
    .nav-btn:hover { background: rgba(255,71,87,.08); color: var(--primary); transform: translateY(-2px); }
    .nav-btn.active {
      background: var(--text-main);
      color: var(--bg-card);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
    }
    [data-theme="dark"] .nav-btn.active { background: #fff; color: #000; }

    .badge {
      position: absolute;
      top: -6px;
      right: -4px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      background: var(--primary);
      color: #fff;
      font-size: 11px;
      font-weight: 900;
      border: 2px solid var(--bg-card);
      animation: popIn .4s var(--ease-elastic);
    }

    /* LAYOUT */
    .main {
      display: grid;
      grid-template-columns: 320px 1fr 320px;
      gap: 16px;
      align-items: start;
      flex: 1;
    }

    .card {
      background: var(--bg-glass);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: var(--backdrop);
      -webkit-backdrop-filter: var(--backdrop);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: 16px;
      animation: slideUpFade .6s var(--ease);
    }

    .card-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .14em;
      font-weight: 900;
      color: var(--text-sub);
      margin-bottom: 12px;
    }

    .stat-grid { display: grid; gap: 10px; }
    .stat {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px;
      border-radius: var(--radius-md);
      background: var(--bg-card);
      border: 1px solid rgba(0,0,0,.05);
      transition: transform .25s var(--ease), box-shadow .25s var(--ease);
    }
    [data-theme="dark"] .stat { border-color: rgba(255,255,255,.06); }
    .stat:hover { transform: translateX(4px) scale(1.01); box-shadow: var(--shadow-md); }
    .stat span:first-child { color: var(--text-sub); font-weight: 700; font-size: 13px; }
    .stat span:last-child { font-weight: 900; }

    /* Sections */
    .section { display: none; }
    .section.active { display: block; animation: slideUpFade .5s var(--ease); }

    /* Browse/Profile card */
    .browse-toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }

    .input, select.input, textarea.input {
      width: 100%;
      padding: 12px 14px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(0,0,0,.08);
      background: var(--bg-card);
      color: var(--text-main);
      outline: none;
      transition: box-shadow .2s var(--ease), transform .2s var(--ease), border-color .2s var(--ease);
      font-family: inherit;
    }
    textarea.input { resize: vertical; min-height: 80px; }
    [data-theme="dark"] .input { border-color: rgba(255,255,255,.08); }
    .input:focus { border-color: rgba(255,71,87,.45); box-shadow: 0 0 0 4px rgba(255,71,87,.15); }

    .btn {
      border: none;
      cursor: pointer;
      border-radius: var(--radius-md);
      padding: 12px 16px;
      font-weight: 900;
      transition: transform .2s var(--ease-elastic), filter .2s var(--ease);
      user-select: none;
    }
    .btn:active { transform: scale(.97); }
    .btn-primary { background: var(--text-main); color: var(--bg-card); }
    .btn-primary:hover { filter: brightness(1.05); transform: translateY(-2px); }
    .btn-ghost { background: rgba(255,71,87,.10); color: var(--primary); }
    .btn-ghost:hover { transform: translateY(-2px); filter: brightness(1.02); }

    .profile-card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      height: min(72vh, 680px);
      position: relative;
      transform-origin: center bottom;
    }

    .photo {
      height: 100%;
      background: #eee;
      position: relative;
      overflow: hidden;
      display: grid;
      place-items: center;
      transition: filter .3s var(--ease);
    }

    .photo::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,.85), rgba(0,0,0,.15), transparent);
      pointer-events: none;
    }

    .photo-emoji {
      font-size: 110px;
      z-index: 2;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.25));
      transform: translateY(-10px);
    }
    
    .photo-bg-img {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      z-index: 1;
    }

    .photo-nav {
      position: absolute;
      inset: 0;
      display: flex;
      z-index: 4;
    }
    .photo-nav button {
      flex: 1;
      border: none;
      background: transparent;
      cursor: pointer;
      color: transparent;
    }

    .photo-dots {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 92%;
      display: flex;
      gap: 6px;
      z-index: 5;
    }
    .dot {
      height: 4px;
      flex: 1;
      border-radius: 99px;
      background: rgba(255,255,255,.25);
      transition: transform .2s var(--ease), background .2s var(--ease);
    }
    .dot.active { background: rgba(255,255,255,.92); transform: scaleY(1.6); }

    .badge-top {
      position: absolute;
      z-index: 6;
      top: 14px;
      padding: 7px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: #fff;
      box-shadow: 0 10px 25px rgba(0,0,0,.15);
      animation: popIn .5s var(--ease-elastic);
    }
    .badge-ai { right: 14px; background: rgba(46, 213, 115, .92); }
    .badge-verified { left: 14px; background: rgba(55,66,250,.92); }
    .badge-online { left: 14px; top: 54px; background: rgba(46, 213, 115, .92); }

    .profile-info {
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      padding: 22px 22px 110px 22px;
      color: #fff;
      z-index: 6;
    }
    .p-name { font-size: 30px; font-weight: 900; margin: 0 0 4px; }
    .p-meta { font-weight: 800; opacity: .92; margin-bottom: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    .p-bio { opacity: .9; margin: 0 0 12px; line-height: 1.5; max-width: 95%; }
    .tags { display: flex; gap: 8px; flex-wrap: wrap; }
    .tag {
      border: 1px solid rgba(255,255,255,.28);
      background: rgba(255,255,255,.16);
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 13px;
      transition: transform .2s var(--ease);
    }
    .tag:hover { transform: translateY(-2px); }

    .actions {
      position: absolute;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      width: 100%;
      z-index: 8;
      pointer-events: auto;
    }

    .fab {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: grid;
      place-items: center;
      font-size: 22px;
      box-shadow: 0 14px 28px rgba(0,0,0,.18);
      transition: transform .25s var(--ease-elastic), filter .25s var(--ease);
    }
    .fab:hover { transform: translateY(-6px) scale(1.08); }
    .fab:active { transform: scale(.92); }

    .fab-like { width: 74px; height: 74px; background: var(--gradient-primary); color: #fff; animation: pulseGlow 2.2s infinite; }
    .fab-skip { background: #fff; color: #3b4356; }
    .fab-super { background: #fff; color: var(--warning); }
    .fab-gift { background: #fff; color: var(--secondary); }

    /* Matches */
    .list { display: grid; gap: 10px; }
    .match {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      padding: 12px;
      border: 1px solid rgba(0,0,0,.05);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: transform .25s var(--ease), box-shadow .25s var(--ease);
    }
    [data-theme="dark"] .match { border-color: rgba(255,255,255,.06); }
    .match:hover { transform: translateY(-3px) scale(1.01); box-shadow: var(--shadow-md); }

    .avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 24px;
      background: #eee;
      flex: 0 0 auto;
      transition: transform .25s var(--ease);
      background-size: cover;
      background-position: center;
    }
    .match:hover .avatar { transform: rotate(8deg); }

    .match-info { flex: 1; min-width: 0; }
    .match-name { font-weight: 900; margin: 0; }
    .match-sub { color: var(--text-sub); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .compat {
      font-weight: 900;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(46,213,115,.12);
      color: var(--accent);
      border: 1px solid rgba(46,213,115,.25);
    }

    /* Gifts */
    .gifts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }

    .gift {
      background: var(--bg-card);
      border: 1px solid rgba(0,0,0,.05);
      border-radius: var(--radius-lg);
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: transform .25s var(--ease-elastic), box-shadow .25s var(--ease), border-color .25s var(--ease);
    }
    [data-theme="dark"] .gift { border-color: rgba(255,255,255,.06); }
    .gift:hover { transform: translateY(-8px); box-shadow: var(--shadow-md); border-color: rgba(255,71,87,.35); }
    .gift-emoji { font-size: 46px; display: block; margin-bottom: 8px; transition: transform .25s var(--ease-elastic); }
    .gift:hover .gift-emoji { transform: rotate(10deg) scale(1.12); }
    .gift-name { font-weight: 900; margin: 0 0 4px; }
    .gift-cost {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      background: rgba(255,165,2,.12);
      color: var(--warning);
      border: 1px solid rgba(255,165,2,.25);
    }

    /* Profile + verification */
    .profile-box {
      max-width: 720px;
      margin: 0 auto;
      background: var(--bg-glass);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius-xl);
      padding: 18px;
      box-shadow: var(--shadow-md);
      backdrop-filter: var(--backdrop);
      -webkit-backdrop-filter: var(--backdrop);
    }

    .profile-hero {
      display: grid;
      gap: 14px;
      place-items: center;
      padding: 16px 10px;
      text-align: center;
    }

    .big-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: var(--gradient-primary);
      color: #fff;
      display: grid;
      place-items: center;
      font-size: 56px;
      box-shadow: 0 0 0 0 rgba(255,71,87,.0);
      animation: pulseGlow 3s infinite;
      background-size: cover;
      background-position: center;
      position: relative;
    }

    /* New Photo Upload styles */
    .photo-upload-box {
      width: 100%;
      height: 120px;
      border: 2px dashed rgba(0,0,0,0.15);
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-sub);
      background: rgba(0,0,0,0.02);
      margin-bottom: 8px;
      overflow: hidden;
      position: relative;
    }
    [data-theme="dark"] .photo-upload-box { border-color: rgba(255,255,255,0.15); background: rgba(255,255,255,0.02); }
    .photo-upload-box:hover { border-color: var(--primary); color: var(--primary); background: rgba(255,71,87,0.05); }
    .photo-upload-preview {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
    }

    /* Interests styles */
    .interests-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    .interest-tag {
      padding: 8px 14px;
      border-radius: 999px;
      background: var(--bg-input);
      border: 1px solid rgba(0,0,0,.08);
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }
    [data-theme="dark"] .interest-tag { border-color: rgba(255,255,255,.1); }
    .interest-tag:hover { transform: translateY(-2px); }
    .interest-tag.selected {
      background: var(--text-main);
      color: var(--bg-card);
      border-color: var(--text-main);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }


    .form {
      display: grid;
      gap: 12px;
      text-align: left;
      margin-top: 10px;
    }

    .field {
      display: grid;
      gap: 6px;
    }

    .label {
      font-weight: 900;
      font-size: 13px;
      color: var(--text-sub);
    }

    .error {
      font-size: 12px;
      color: var(--primary);
      font-weight: 800;
      display: none;
    }

    .input.invalid { border-color: rgba(255,71,87,.75) !important; box-shadow: 0 0 0 4px rgba(255,71,87,.14) !important; }

    /* Online sidebar */
    .mini-list { display: grid; gap: 10px; }
    .mini {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: var(--radius-md);
      background: var(--bg-card);
      border: 1px solid rgba(0,0,0,.05);
      transition: transform .25s var(--ease);
      cursor: pointer;
    }
    [data-theme="dark"] .mini { border-color: rgba(255,255,255,.06); }
    .mini:hover { transform: translateX(4px); }
    .mini .avatar { width: 44px; height: 44px; font-size: 20px; }
    .mini .mname { font-weight: 900; font-size: 13px; }
    .mini .mmeta { font-size: 12px; color: var(--text-sub); }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 1000;
    }
    .modal.active { display: flex; }

    .modal-content {
      width: 100%;
      max-width: 560px;
      max-height: 88vh;
      overflow: auto;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(0,0,0,.06);
      animation: popIn .35s var(--ease-elastic);
      position: relative;
    }

    .modal-head {
      padding: 16px 16px 0 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .modal-close {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      background: rgba(0,0,0,.08);
      transition: transform .2s var(--ease-elastic), background .2s var(--ease);
    }
    .modal-close:hover { transform: rotate(90deg); background: var(--primary); color: #fff; }

    .modal-body { padding: 16px; }

    /* Chat */
    .chat {
      height: 520px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .chat-log {
      flex: 1;
      overflow: auto;
      background: var(--bg-input);
      border-radius: var(--radius-lg);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      border: 1px solid rgba(0,0,0,.06);
    }
    [data-theme="dark"] .chat-log { border-color: rgba(255,255,255,.06); }

    .msg {
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 18px;
      font-size: 14px;
      line-height: 1.4;
      animation: slideUpFade .25s var(--ease);
    }
    .msg.me { align-self: flex-end; background: var(--primary); color: #fff; border-bottom-right-radius: 6px; }
    .msg.other { align-self: flex-start; background: var(--bg-card); color: var(--text-main); border-bottom-left-radius: 6px; box-shadow: var(--shadow-sm); }

    .chat-input {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .send {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      background: var(--primary);
      color: #fff;
      font-size: 18px;
      transition: transform .2s var(--ease-elastic);
    }
    .send:hover { transform: rotate(-12deg) scale(1.06); }

    /* Toast + realtime notification */
    .toast {
      position: fixed;
      left: 50%;
      top: 18px;
      transform: translateX(-50%) translateY(-120px);
      background: var(--text-main);
      color: var(--bg-card);
      border-radius: 999px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 18px 60px rgba(0,0,0,.22);
      z-index: 2000;
      transition: transform .35s var(--ease-elastic);
      font-weight: 800;
      max-width: min(92vw, 720px);
    }
    .toast.show { transform: translateX(-50%) translateY(0); }

    .rt-bell {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 2100;
      display: grid;
      gap: 10px;
      justify-items: end;
      pointer-events: none;
    }

    .rt-card {
      pointer-events: auto;
      width: min(360px, 92vw);
      background: var(--bg-card);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 18px;
      box-shadow: var(--shadow-lg);
      padding: 12px;
      display: grid;
      gap: 8px;
      animation: popIn .35s var(--ease-elastic);
    }

    .rt-top { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .rt-title { font-weight: 900; }
    .rt-sub { font-size: 13px; color: var(--text-sub); }

    .rt-actions { display: flex; gap: 10px; }

    /* Responsive */
    @media (max-width: 1080px) {
      .main { grid-template-columns: 320px 1fr; }
      .right { display: none; }
    }

    @media (max-width: 820px) {
      header { top: 0; border-radius: 0 0 var(--radius-lg) var(--radius-lg); }
      .container { padding: 0; }
      .main { grid-template-columns: 1fr; padding: 12px; }
      .left { order: 2; }
      .center { order: 1; }
      .right { display: none; }
      .profile-card { height: 66vh; }
      nav { gap: 6px; }
      .nav-btn { padding: 10px 12px; font-size: 13px; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="header-top">
        <div class="logo" onclick="showSection('browse')" title="EvilCorp">
  <span style="overflow: hidden; display: flex; align-items: center; justify-content: center;">
    <img src="logo.png" alt="Logo" style="width: 100%; height: 100%; object-fit: cover;">
  </span>
  <div>
    <div style="font-size:18px; line-height:1;">Evil<b>Corp</b></div>
    <div style="font-size:12px; font-weight:800; color:var(--text-sub);">New features ‚Ä¢ Real-time</div>
  </div>
</div>

        <div class="header-actions">
          <div class="pill" title="–ë–∞–ª–∞–Ω—Å / Balance">
            ‚≠ê <span id="starBalance">0</span>
          </div>
          <div class="pill" title="–ú–∞—Ç—á—Ç–∞—Ä / –ú–∞—Ç—á–∏">
            üíò <span id="matchCount">0</span>
          </div>

          <button class="icon-btn theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
          <button class="icon-btn lang-toggle" onclick="toggleLang()" aria-label="Toggle language"></button>
        </div>
      </div>

      <nav>
        <button class="nav-btn active" data-section="browse" onclick="showSection('browse')">üîç <span data-i18n="nav_search">–Ü–∑–¥–µ—É</span></button>
        <button class="nav-btn" data-section="matches" onclick="showSection('matches')">
          üí¨ <span data-i18n="nav_chats">–ß–∞—Ç—Ç–∞—Ä</span>
          <span class="badge" id="unreadBadge" style="display:none;">0</span>
        </button>
        <button class="nav-btn" data-section="gifts" onclick="showSection('gifts')">üéÅ <span data-i18n="nav_gifts">–°—ã–π–ª—ã“õ—Ç–∞—Ä</span></button>
        <button class="nav-btn" data-section="profile" onclick="showSection('profile')">üë§ <span data-i18n="nav_profile">–ü—Ä–æ—Ñ–∏–ª—å</span></button>
      </nav>
    </header>

    <div class="main">
      <aside class="card left">
        <div class="card-title" data-i18n="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div class="stat-grid">
          <div class="stat"><span data-i18n="views">–ö”©—Ä—É–ª–µ—Ä</span><span id="views">0</span></div>
          <div class="stat"><span data-i18n="likes">“∞–Ω–∞—Ç“õ–∞–Ω–¥–∞—Ä</span><span id="likes">0</span></div>
          <div class="stat"><span data-i18n="ai">AI Score</span><span id="aiScoreSmall" style="color:var(--accent)">--</span></div>
          <div class="stat"><span data-i18n="verified">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</span><span id="verifiedSmall">‚Äî</span></div>
        </div>

        <div style="height:14px"></div>
        <div class="card-title" data-i18n="realtime">Real-time</div>
        <div class="stat-grid">
          <div class="stat"><span data-i18n="rt_status">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span><span id="rtStatus" style="color:var(--accent)">ON</span></div>
          <div class="stat"><span data-i18n="rt_hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞</span><span style="color:var(--text-sub); font-weight:800;">New match</span></div>
        </div>

        <div style="height:14px"></div>
        <button class="btn btn-ghost" onclick="simulateRealtimeMatch()" style="width:100%;">
          ‚ö° <span data-i18n="simulate">–°–∏–º—É–ª—è—Ü–∏—è –º–∞—Ç—á–∞</span>
        </button>
      </aside>

      <main class="center">
        <section class="section active" id="browse">
          <div class="browse-toolbar">
            <select class="input" id="citySelect" aria-label="City">
              <option value="" data-i18n="all_cities">–ë–∞—Ä–ª—ã“õ “õ–∞–ª–∞–ª–∞—Ä</option>
              <option value="–ê–ª–º–∞—Ç—ã">–ê–ª–º–∞—Ç—ã</option>
              <option value="–ê—Å—Ç–∞–Ω–∞">–ê—Å—Ç–∞–Ω–∞</option>
              <option value="–®—ã–º–∫–µ–Ω—Ç">–®—ã–º–∫–µ–Ω—Ç</option>
              <option value="–ö–∞—Ä–∞–≥–∞–Ω–¥—ã">–ö–∞—Ä–∞–≥–∞–Ω–¥—ã</option>
              <option value="–ê—Ç—ã—Ä–∞—É">–ê—Ç—ã—Ä–∞—É</option>
              <option value="–ê“õ—Ç–∞—É">–ê“õ—Ç–∞—É</option>
              <option value="–ü–∞–≤–ª–æ–¥–∞—Ä">–ü–∞–≤–ª–æ–¥–∞—Ä</option>
            </select>
            <button class="btn btn-primary" onclick="filterByCity()">Go</button>
          </div>

          <div class="profile-card" id="profileCard">
            <div class="photo" id="photo">
              <div class="photo-dots" id="photoDots"></div>
              <div class="badge-top badge-ai">ü§ñ <span id="aiScore">--</span>%</div>
              <div class="badge-top badge-verified" id="verifiedBadge" style="display:none;">‚úì Verified</div>
              <div class="badge-top badge-online" id="onlineBadge" style="display:none;">‚óè Online</div>
              <div class="photo-emoji" id="photoEmoji">üë§</div>

              <div class="photo-nav">
                <button onclick="prevPhoto()" aria-label="Previous photo"></button>
                <button onclick="nextPhoto()" aria-label="Next photo"></button>
              </div>

              <div class="profile-info">
                <h2 class="p-name" id="pName">Loading‚Ä¶</h2>
                <div class="p-meta" id="pMeta">‚Ä¶</div>
                <p class="p-bio" id="pBio">‚Ä¶</p>
                <div class="tags" id="pTags"></div>
              </div>

              <div class="actions">
                <button class="fab fab-skip" onclick="skip()" title="Skip">‚úï</button>
                <button class="fab fab-super" onclick="superLike()" title="Super like">‚≠ê</button>
                <button class="fab fab-like" onclick="like()" title="Like">‚ù§Ô∏è</button>
                <button class="fab fab-gift" onclick="openGiftModal()" title="Gift">üéÅ</button>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="matches">
          <div class="card" style="background:transparent; border:none; box-shadow:none; padding:0;">
            <div class="card-title" style="font-size:14px;" data-i18n="your_matches">–í–∞—à–∏ –º–∞—Ç—á–∏</div>
            <div class="list" id="matchesList"></div>
          </div>
        </section>

        <section class="section" id="gifts">
          <div class="card" style="background:transparent; border:none; box-shadow:none; padding:0;">
            <div class="card-title" style="font-size:14px;" data-i18n="gift_shop">–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤</div>
            <div class="gifts-grid" id="giftsGrid"></div>
          </div>
        </section>

        <section class="section" id="profile">
          <div class="profile-box">
            <div class="profile-hero">
              <div class="big-avatar" id="meAvatar">
                üë§
              </div>
              <div>
                <div style="font-weight:900; font-size:18px;" id="meName">User</div>
                <div style="color:var(--text-sub); font-weight:800;" id="meCity">‚Äî</div>
              </div>
            </div>

            <div class="stat" style="margin: 0 0 12px;">
              <span data-i18n="verification_status">–°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏</span>
              <span id="verificationStatus" style="font-weight:900;">‚Äî</span>
            </div>

            <form class="form" id="profileForm" novalidate>
              
              <div class="field">
                <div class="label" data-i18n="upload_photo">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                <label class="photo-upload-box">
                  <span style="font-size:24px; margin-bottom:4px;">üì∑</span>
                  <span style="font-size:12px; font-weight:700;" data-i18n="photo_hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</span>
                  <input type="file" id="inpFile" accept="image/*" hidden onchange="handleFileSelect(event)">
                  <div class="photo-upload-preview" id="photoPreview" style="display:none;"></div>
                </label>
              </div>

              <div class="field">
                <div class="label" data-i18n="your_name">–í–∞—à–µ –∏–º—è</div>
                <input class="input" id="inpName" type="text" placeholder="Aruzhan / –ê—Ä—Ç—ë–º" required minlength="2" maxlength="20" />
                <div class="error" id="errName" data-i18n="err_name">–í–≤–µ–¥–∏—Ç–µ –∏–º—è (2-20 —Å–∏–º–≤–æ–ª–æ–≤).</div>
              </div>

              <div class="field">
                <div class="label" data-i18n="your_city">–í–∞—à –≥–æ—Ä–æ–¥</div>
                <select class="input" id="inpCity" required>
                  <option value="" data-i18n="choose_city">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                  <option value="–ê–ª–º–∞—Ç—ã">–ê–ª–º–∞—Ç—ã</option>
                  <option value="–ê—Å—Ç–∞–Ω–∞">–ê—Å—Ç–∞–Ω–∞</option>
                  <option value="–®—ã–º–∫–µ–Ω—Ç">–®—ã–º–∫–µ–Ω—Ç</option>
                  <option value="–ö–∞—Ä–∞–≥–∞–Ω–¥—ã">–ö–∞—Ä–∞–≥–∞–Ω–¥—ã</option>
                  <option value="–ê—Ç—ã—Ä–∞—É">–ê—Ç—ã—Ä–∞—É</option>
                  <option value="–ê“õ—Ç–∞—É">–ê“õ—Ç–∞—É</option>
                  <option value="–ü–∞–≤–ª–æ–¥–∞—Ä">–ü–∞–≤–ª–æ–¥–∞—Ä</option>
                </select>
                <div class="error" id="errCity" data-i18n="err_city">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥.</div>
              </div>

              <div class="field">
                <div class="label" data-i18n="email">Email</div>
                <input class="input" id="inpEmail" type="email" placeholder="name@mail.com" required />
                <div class="error" id="errEmail" data-i18n="err_email">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email.</div>
              </div>

              <div class="field">
                <div class="label" data-i18n="age">–í–æ–∑—Ä–∞—Å—Ç</div>
                <input class="input" id="inpAge" type="number" min="18" max="80" placeholder="18" required />
                <div class="error" id="errAge" data-i18n="err_age">–í–æ–∑—Ä–∞—Å—Ç: 18‚Äì80.</div>
              </div>

              <div class="field">
                <div class="label" data-i18n="bio_label">–û —Å–µ–±–µ</div>
                <textarea class="input" id="inpBio" placeholder="..." maxlength="150"></textarea>
              </div>

              <div class="field">
                <div class="label" data-i18n="interests_label">–ò–Ω—Ç–µ—Ä–µ—Å—ã (–≤—ã–±–µ—Ä–∏—Ç–µ)</div>
                <div class="interests-grid" id="interestContainer"></div>
              </div>

              <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
                <button class="btn btn-primary" type="submit">üíæ <span data-i18n="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span></button>
                <button class="btn btn-ghost" type="button" onclick="verifyProfile()">üì∏ <span data-i18n="verify">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è</span></button>
              </div>
            </form>

            <div style="height:10px"></div>
            <div style="color:var(--text-sub); font-weight:800; font-size:13px; line-height:1.5;">
              <span data-i18n="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞:</span> <span data-i18n="hint_text">–ª–∞–π–∫ ‚Üí —à–∞–Ω—Å –º–∞—Ç—á–∞. –ü—Ä–∏ –º–∞—Ç—á–µ –ø–æ—è–≤–∏—Ç—Å—è real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.</span>
            </div>
          </div>
        </section>
      </main>

      <aside class="card right">
        <div class="card-title" data-i18n="online">–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</div>
        <div class="mini-list" id="onlineList"></div>
      </aside>
    </div>
  </div>

  <div class="modal" id="giftModal" onclick="modalBackdropClose(event, 'giftModal')">
    <div class="modal-content">
      <div class="modal-head">
        <div style="font-weight:900;" data-i18n="choose_gift">üéÅ –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫</div>
        <button class="modal-close" onclick="closeModal('giftModal')" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="gifts-grid" id="giftModalGrid"></div>
      </div>
    </div>
  </div>

  <div class="modal" id="chatModal" onclick="modalBackdropClose(event, 'chatModal')">
    <div class="modal-content">
      <div class="modal-head">
        <div>
          <div style="font-weight:900;" id="chatTitle">üí¨ –ß–∞—Ç</div>
          <div style="font-size:12px; color:var(--text-sub); font-weight:800;" id="chatSubtitle">‚Äî</div>
        </div>
        <button class="modal-close" onclick="closeModal('chatModal')" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="chat">
          <div class="chat-log" id="chatLog"></div>
          <div class="chat-input">
            <input class="input" id="chatInput" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶" maxlength="280" />
            <button class="send" onclick="sendMessage()" aria-label="Send">‚û§</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">
    <span id="toastIcon">‚ú®</span>
    <span id="toastText">‚Äî</span>
  </div>

  <div class="rt-bell" id="rtBell"></div>

  <script>
    // ==========================================================
    // EvilCorp ‚Äî Single-file JS
    // ==========================================================

    // ---------- I18N (KZ/RU) ----------
    const i18n = {
      ru: {
        nav_search: '–ü–æ–∏—Å–∫',
        nav_chats: '–ß–∞—Ç—ã',
        nav_gifts: '–ü–æ–¥–∞—Ä–∫–∏',
        nav_profile: '–ü—Ä–æ—Ñ–∏–ª—å',
        stats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        views: '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã',
        likes: '–õ–∞–π–∫–∏',
        ai: 'AI Score',
        verified: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è',
        realtime: 'Real-time',
        rt_status: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',
        rt_hint: '–°–æ–±—ã—Ç–∏–µ',
        simulate: '–°–∏–º—É–ª—è—Ü–∏—è –º–∞—Ç—á–∞',
        all_cities: '–í—Å–µ –≥–æ—Ä–æ–¥–∞',
        your_matches: '–í–∞—à–∏ –º–∞—Ç—á–∏',
        gift_shop: '–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤',
        online: '–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å',
        verification_status: '–°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏',
        your_name: '–í–∞—à–µ –∏–º—è',
        your_city: '–í–∞—à –≥–æ—Ä–æ–¥',
        choose_city: '–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥',
        email: 'Email',
        age: '–í–æ–∑—Ä–∞—Å—Ç',
        bio_label: '–û —Å–µ–±–µ',
        interests_label: '–ò–Ω—Ç–µ—Ä–µ—Å—ã',
        upload_photo: '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ',
        photo_hint: '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞',
        save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        verify: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è',
        hint: '–ü–æ–¥—Å–∫–∞–∑–∫–∞:',
        hint_text: '–ª–∞–π–∫ ‚Üí —à–∞–Ω—Å –º–∞—Ç—á–∞. –ü—Ä–∏ –º–∞—Ç—á–µ –ø–æ—è–≤–∏—Ç—Å—è real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. (–ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞)',
        err_name: '–í–≤–µ–¥–∏—Ç–µ –∏–º—è (2-20 —Å–∏–º–≤–æ–ª–æ–≤).',
        err_city: '–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥.',
        err_email: '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email.',
        err_age: '–í–æ–∑—Ä–∞—Å—Ç: 18‚Äì80.',
        choose_gift: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫',
        toast_saved: '–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω',
        toast_verified: '–ü—Ä–æ—Ñ–∏–ª—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω ‚úì',
        toast_like: '–õ–∞–π–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚ù§Ô∏è',
        toast_skip: '–ü—Ä–æ–ø—É—Å–∫',
        toast_super: '–°—É–ø–µ—Ä–ª–∞–π–∫ ‚≠ê',
        toast_gift: '–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω üéÅ',
        toast_match: '–ù–æ–≤—ã–π –º–∞—Ç—á! üíò',
        chat_placeholder: '–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶',
        rt_new_match: '–ù–æ–≤—ã–π –º–∞—Ç—á',
        rt_open_chat: '–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç',
        rt_close: '–ó–∞–∫—Ä—ã—Ç—å',
        // Categories
        cat_music: 'üéµ –ú—É–∑—ã–∫–∞',
        cat_sport: 'üèÄ –°–ø–æ—Ä—Ç',
        cat_travel: '‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è',
        cat_gaming: 'üéÆ –ì–µ–π–º–∏–Ω–≥',
        cat_art: 'üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ',
        cat_cooking: 'üç≥ –ì–æ—Ç–æ–≤–∫–∞',
        cat_movies: 'üé¨ –ö–∏–Ω–æ',
        cat_tech: 'üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏',
        cat_nature: 'üçÉ –ü—Ä–∏—Ä–æ–¥–∞',
      },
      kz: {
        nav_search: '–Ü–∑–¥–µ—É',
        nav_chats: '–ß–∞—Ç—Ç–∞—Ä',
        nav_gifts: '–°—ã–π–ª—ã“õ—Ç–∞—Ä',
        nav_profile: '–ü—Ä–æ—Ñ–∏–ª—å',
        stats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        views: '–ö”©—Ä—É–ª–µ—Ä',
        likes: '“∞–Ω–∞—Ç“õ–∞–Ω–¥–∞—Ä',
        ai: 'AI Score',
        verified: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è',
        realtime: 'Real-time',
        rt_status: '–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É',
        rt_hint: '–û“õ–∏“ì–∞',
        simulate: '–ú–∞—Ç—á —Å–∏–º—É–ª—è—Ü–∏—è—Å—ã',
        all_cities: '–ë–∞—Ä–ª—ã“õ “õ–∞–ª–∞–ª–∞—Ä',
        your_matches: '–°—ñ–∑–¥—ñ“£ –º–∞—Ç—á—Ç–∞—Ä',
        gift_shop: '–°—ã–π–ª—ã“õ –¥“Ø–∫–µ–Ω—ñ',
        online: '“ö–∞–∑—ñ—Ä –æ–Ω–ª–∞–π–Ω',
        verification_status: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å—ã',
        your_name: '–ê—Ç—ã“£—ã–∑',
        your_city: '“ö–∞–ª–∞“£—ã–∑',
        choose_city: '“ö–∞–ª–∞–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑',
        email: 'Email',
        age: '–ñ–∞—Å',
        bio_label: '”®–∑—ñ–º –∂–∞–π–ª—ã',
        interests_label: '“ö—ã–∑—ã“ì—É—à—ã–ª—ã“õ—Ç–∞—Ä',
        upload_photo: '–§–æ—Ç–æ –∂“Ø–∫—Ç–µ—É',
        photo_hint: '–¢–∞“£–¥–∞—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑',
        save: '–°–∞“õ—Ç–∞—É',
        verify: '–ü—Ä–æ—Ñ–∏–ª—å–¥—ñ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è–ª–∞—É',
        hint: '–ö–µ“£–µ—Å:',
        hint_text: '–ª–∞–π–∫ ‚Üí –º–∞—Ç—á —ã“õ—Ç–∏–º–∞–ª–¥—ã“ì—ã. –ú–∞—Ç—á –±–æ–ª—Å–∞ real-time —Ö–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É —à—ã“ì–∞–¥—ã.',
        err_name: '–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ (2-20 —Ç–∞“£–±–∞).',
        err_city: '“ö–∞–ª–∞–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑.',
        err_email: '–î“±—Ä—ã—Å email –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.',
        err_age: '–ñ–∞—Å: 18‚Äì80.',
        choose_gift: '–°—ã–π–ª—ã“õ —Ç–∞“£–¥–∞“£—ã–∑',
        toast_saved: '–ü—Ä–æ—Ñ–∏–ª—å —Å–∞“õ—Ç–∞–ª–¥—ã',
        toast_verified: '–ü—Ä–æ—Ñ–∏–ª—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è–¥–∞–Ω ”©—Ç—Ç—ñ ‚úì',
        toast_like: '–õ–∞–π–∫ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ ‚ù§Ô∏è',
        toast_skip: '”®—Ç–∫—ñ–∑—É',
        toast_super: '–°—É–ø–µ—Ä–ª–∞–π–∫ ‚≠ê',
        toast_gift: '–°—ã–π–ª—ã“õ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ üéÅ',
        toast_match: '–ñ–∞“£–∞ –º–∞—Ç—á! üíò',
        chat_placeholder: '–•–∞–±–∞—Ä–ª–∞–º–∞‚Ä¶',
        rt_new_match: '–ñ–∞“£–∞ –º–∞—Ç—á',
        rt_open_chat: '–ß–∞—Ç—Ç—ã –∞—à—É',
        rt_close: '–ñ–∞–±—É',
        // Categories
        cat_music: 'üéµ –ú—É–∑—ã–∫–∞',
        cat_sport: 'üèÄ –°–ø–æ—Ä—Ç',
        cat_travel: '‚úàÔ∏è –°–∞—è—Ö–∞—Ç',
        cat_gaming: 'üéÆ –û–π—ã–Ω–¥–∞—Ä',
        cat_art: 'üé® ”®–Ω–µ—Ä',
        cat_cooking: 'üç≥ –ê—Å–ø–∞–∑–¥—ã“õ',
        cat_movies: 'üé¨ –ö–∏–Ω–æ',
        cat_tech: 'üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è',
        cat_nature: 'üçÉ –¢–∞–±–∏“ì–∞—Ç',
      }
    };

    // ---------- Data ----------
    const photoGradients = [
      'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
      'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
      'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
      'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
      'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
      'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
      'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
    ];

    const profileDatabase = [
      { id: 1, name: '–ö–∞–∑–±–µ–∫–æ–≤–∞ –ê–π–≥–µ—Ä–∏–º', age: 24, city: '–ê–ª–º–∞—Ç—ã', distance: 2, emoji: 'üë©', bio: '–ñ–∞—Ä–∞—Ç—ã–ª—ã—Å—Ç—ã –∂–∞“õ—Å—ã –∫”©—Ä–µ–º—ñ–Ω, —Å–∞—è—Ö–∞—Ç –ø–µ–Ω —Ç–∞—É–ª–∞—Ä–¥—ã –∂–∞“õ—Å—ã –∫”©—Ä–µ–º—ñ–Ω üèîÔ∏è', interests: ['üé® ”®–Ω–µ—Ä','üéµ –ú—É–∑—ã–∫–∞','‚úàÔ∏è –°–∞—è—Ö–∞—Ç'], verified: true, online: true, aiScore: 92, photos: [0,1,2,3] },
      { id: 2, name: '–î–∞–Ω–∞', age: 26, city: '–ê—Å—Ç–∞–Ω–∞', distance: 5, emoji: 'üë©‚Äçüíº', bio: '–°—Ç–∞—Ä—Ç–∞–ø “õ“±—Ä—É—à—ã—Å—ã –∂”ô–Ω–µ —Ç–µ—Ö–Ω–æ ”ô—É–µ—Å“õ–æ–π üíª', interests: ['üíº –ë–∏–∑–Ω–µ—Å','üéÆ –û–π—ã–Ω–¥–∞—Ä','üìö –ö—ñ—Ç–∞–ø—Ç–∞—Ä'], verified: true, online: false, aiScore: 88, photos: [1,2,3,0] },
      { id: 3, name: '–ö–∞–º–∏–ª–∞', age: 23, city: '–®—ã–º–∫–µ–Ω—Ç', distance: 3, emoji: 'üë©‚Äçüéì', bio: '–ú–µ–¥–∏—Ü–∏–Ω–∞ –æ“õ—É—à—ã—Å—ã, –π–æ–≥–∞ –∂”ô–Ω–µ –¥–µ–Ω—ñ —Ç–∞–º–∞“õ ”ô—É–µ—Å“õ–æ–π üßò‚Äç‚ôÄÔ∏è', interests: ['üè• –ú–µ–¥–∏—Ü–∏–Ω–∞','üçÉ –ô–æ–≥–∞','ü•ó –î–µ–Ω—ñ —Ç–∞–º–∞“õ'], verified: false, online: true, aiScore: 85, photos: [2,3,0,1] },
      { id: 4, name: '–ñ–∞–Ω–∞—Ä', age: 27, city: '–ê–ª–º–∞—Ç—ã', distance: 4, emoji: 'üë©‚Äçüç≥', bio: '–ê—Å–ø–∞–∑, –∂–∞“£–∞ —Ä–µ—Ü–µ–ø—Ç—Ç–µ—Ä–¥—ñ –∂–∞—Å–∞—É–¥—ã “±–Ω–∞—Ç–∞–º—ã–Ω üçΩÔ∏è', interests: ['üç≥ –ê—Å–ø–∞–∑–¥—ã“õ','üç∑ –¢–∞–º–∞“õ','üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è'], verified: true, online: true, aiScore: 90, photos: [3,0,1,2] },
      { id: 5, name: '–ê–ª–∏–Ω–∞', age: 25, city: '–ê—Å—Ç–∞–Ω–∞', distance: 6, emoji: 'üë©‚Äçüé§', bio: '–ú—É–∑—ã–∫–∞–Ω—Ç –∂”ô–Ω–µ –∫–æ–º–ø–æ–∑–∏—Ç–æ—Ä üé∂', interests: ['üé∏ –ú—É–∑—ã–∫–∞','üé≠ –¢–µ–∞—Ç—Ä','üé¨ –ö–∏–Ω–æ'], verified: false, online: false, aiScore: 82, photos: [4,5,6,7] },
      { id: 6, name: '–ñ–∞–Ω–∏—è', age: 28, city: '–ö–∞—Ä–∞–≥–∞–Ω–¥—ã', distance: 7, emoji: 'üë©‚Äçüíª', bio: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –∂”ô–Ω–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç ”ô—É–µ—Å“õ–æ–π ü§ñ', interests: ['üíª –ö–æ–¥—Ç–∞—É','üß† AI','üìä –î–µ—Ä–µ–∫—Ç–µ—Ä'], verified: true, online: true, aiScore: 95, photos: [5,6,7,4] },
      { id: 7, name: '–ú–µ—Ä—É–µ—Ä—Ç', age: 22, city: '–ê–ª–º–∞—Ç—ã', distance: 1, emoji: 'üë©‚Äçüé®', bio: '–î–∏–∑–∞–π–Ω–µ—Ä –∂”ô–Ω–µ –∫—Ä–µ–∞—Ç–∏–≤—Ç—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä üé®', interests: ['üé® –î–∏–∑–∞–π–Ω','üñºÔ∏è ”®–Ω–µ—Ä','‚úèÔ∏è –°—É—Ä–µ—Ç'], verified: false, online: true, aiScore: 87, photos: [6,7,4,5] },
      { id: 8, name: '–ê“õ–±–æ—Ç–∞', age: 29, city: '–ê—Ç—ã—Ä–∞—É', distance: 8, emoji: 'üë©‚Äçüè´', bio: '–ú“±“ì–∞–ª—ñ–º –∂”ô–Ω–µ –±—ñ–ª—ñ–º –±–µ—Ä—É ”ô—É–µ—Å“õ–æ–π üìö', interests: ['üìñ –û“õ—ã—Ç—É','üß© –û–π—ã–Ω–¥–∞—Ä','üéì –ë—ñ–ª—ñ–º'], verified: true, online: false, aiScore: 84, photos: [7,4,5,6] },
      { id: 9, name: '–û—Ä–∞–∑–±–∞–∫–æ–≤ –¢–µ–º–∏—Ä–ª–∞–Ω', age: 25, city: '–ê–ª–º–∞—Ç—ã', distance: 3, emoji: 'üë®', bio: '–°–ø–æ—Ä—Ç ”ô—É–µ—Å“õ–æ–π—ã –∂”ô–Ω–µ —Å–∞—è—Ö–∞—Ç—à—ã üèûÔ∏è', interests: ['üèÄ –°–ø–æ—Ä—Ç','‚úàÔ∏è –°–∞—è—Ö–∞—Ç','üìö –ö—ñ—Ç–∞–ø—Ç–∞—Ä'], verified: true, online: true, aiScore: 89, photos: [0,2,4,6] },
      { id: 10, name: '–ú–∏—Ä–∞—Å –ù—É—Ä–∫–∞—Å—ã–º', age: 28, city: '–ê—Å—Ç–∞–Ω–∞', distance: 4, emoji: 'üë®‚Äçüíª', bio: 'IT –º–∞–º–∞–Ω—ã –∂”ô–Ω–µ –≥–µ–π–º–µ—Ä üéÆ', interests: ['üíª –ü—Ä–æ–≥—Ä–∞–º–º–∞–ª–∞—É','üéÆ –û–π—ã–Ω–¥–∞—Ä','üéµ –ú—É–∑—ã–∫–∞'], verified: false, online: true, aiScore: 91, photos: [1,3,5,7] },
      { id: 11, name: '–¢—É—Ä–∞—à –ê–ª–∏', age: 32, city: '–ê–ª–º–∞—Ç—ã', distance: 4, emoji: 'üë®‚Äçüíª', bio: 'IT –º–∞–º–∞–Ω—ã –∂”ô–Ω–µ –≥–µ–π–º–µ—Ä üéÆ', interests: ['üíª –ü—Ä–æ–≥—Ä–∞–º–º–∞–ª–∞—É','üéÆ –û–π—ã–Ω–¥–∞—Ä','üéµ –ú—É–∑—ã–∫–∞'], verified: false, online: true, aiScore: 91, photos: [1,3,5,7] },
    ];

    const gifts = [
      { nameKz: '–†–∞—É—à–∞–Ω', nameRu: '–†–æ–∑–∞', emoji: 'üåπ', cost: 10 },
      { nameKz: '–®–æ–∫–æ–ª–∞–¥', nameRu: '–®–æ–∫–æ–ª–∞–¥', emoji: 'üç´', cost: 15 },
      { nameKz: '–¢”ô–∂', nameRu: '–ö–æ—Ä–æ–Ω–∞', emoji: 'üëë', cost: 50 },
      { nameKz: '–ì–∞—É“ª–∞—Ä', nameRu: '–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç', emoji: 'üíé', cost: 100 },
      { nameKz: '–ö–æ—Ñ–µ', nameRu: '–ö–æ—Ñ–µ', emoji: '‚òï', cost: 5 },
      { nameKz: '–¢–æ—Ä—Ç', nameRu: '–¢–æ—Ä—Ç', emoji: 'üéÇ', cost: 25 },
      { nameKz: '–†–∞–∫–µ—Ç–∞', nameRu: '–†–∞–∫–µ—Ç–∞', emoji: 'üöÄ', cost: 200 },
      { nameKz: '–ê–π–¥–∞“ª–∞—Ä', nameRu: '–î—Ä–∞–∫–æ–Ω', emoji: 'üêâ', cost: 500 },
    ];
    
    // New Interest Categories
    const interestCategories = [
      'cat_music', 'cat_sport', 'cat_travel', 
      'cat_gaming', 'cat_art', 'cat_cooking',
      'cat_movies', 'cat_tech', 'cat_nature'
    ];

    // ---------- State ----------
    let allProfiles = [...profileDatabase];
    let filteredProfiles = [...allProfiles];
    let idx = 0;
    let photoIdx = 0;

    let starBalance = 1000;
    let views = 0;
    let likes = 0;
    let matches = [];
    let chats = {}; // {matchId: [{me:boolean,text:string,ts:number}]}

    let isVerified = false;
    let giftTarget = null;
    let currentChatId = null;

    // realtime notifications
    let unreadCount = 0;

    // language
    let lang = 'kz';
    
    // New Profile State
    let myInterests = [];
    let myPhoto = null; // Base64 string

    // ---------- Helpers ----------
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function save() {
      localStorage.setItem('dhp_starBalance', String(starBalance));
      localStorage.setItem('dhp_views', String(views));
      localStorage.setItem('dhp_likes', String(likes));
      localStorage.setItem('dhp_matches', JSON.stringify(matches));
      localStorage.setItem('dhp_chats', JSON.stringify(chats));
      localStorage.setItem('dhp_verified', String(isVerified));
      localStorage.setItem('dhp_lang', String(lang));
      
      // Save extended profile
      localStorage.setItem('dhp_profile', JSON.stringify({
        name: $('#inpName')?.value || '',
        city: $('#inpCity')?.value || '',
        email: $('#inpEmail')?.value || '',
        age: $('#inpAge')?.value || '',
        bio: $('#inpBio')?.value || '',
        interests: myInterests,
        photo: myPhoto
      }));
    }

    function load() {
      starBalance = parseInt(localStorage.getItem('dhp_starBalance') || '100', 10);
      views = parseInt(localStorage.getItem('dhp_views') || '0', 10);
      likes = parseInt(localStorage.getItem('dhp_likes') || '0', 10);
      matches = JSON.parse(localStorage.getItem('dhp_matches') || '[]');
      chats = JSON.parse(localStorage.getItem('dhp_chats') || '{}');
      isVerified = localStorage.getItem('dhp_verified') === 'true';
      lang = localStorage.getItem('dhp_lang') || 'kz';

      const prof = JSON.parse(localStorage.getItem('dhp_profile') || '{}');
      if (prof?.name) $('#inpName').value = prof.name;
      if (prof?.city) $('#inpCity').value = prof.city;
      if (prof?.email) $('#inpEmail').value = prof.email;
      if (prof?.age) $('#inpAge').value = prof.age;
      
      // Load new fields
      if (prof?.bio) $('#inpBio').value = prof.bio;
      myInterests = prof.interests || [];
      if (prof?.photo) {
        myPhoto = prof.photo;
        updatePhotoPreview(myPhoto);
      }
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function t(key) {
      return i18n[lang]?.[key] ?? i18n.ru[key] ?? key;
    }

    function toast(icon, text, ms = 2200) {
      $('#toastIcon').textContent = icon;
      $('#toastText').textContent = text;
      const el = $('#toast');
      el.classList.add('show');
      clearTimeout(toast._t);
      toast._t = setTimeout(() => el.classList.remove('show'), ms);
    }

    function updateBadges() {
      $('#starBalance').textContent = starBalance;
      $('#matchCount').textContent = matches.length;
      $('#views').textContent = views;
      $('#likes').textContent = likes;
      $('#verifiedSmall').textContent = isVerified ? '‚úì' : '‚Äî';

      const badge = $('#unreadBadge');
      if (unreadCount > 0) {
        badge.style.display = '';
        badge.textContent = String(unreadCount);
      } else {
        badge.style.display = 'none';
      }
    }

    function applyI18n() {
      document.documentElement.setAttribute('data-lang', lang);
      $$('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
      });
      $('#chatInput').placeholder = t('chat_placeholder');
      $('#inpBio').placeholder = lang === 'kz' ? '”®–∑—ñ“£—ñ–∑ —Ç—É—Ä–∞–ª—ã –∞–π—Ç—ã“£—ã–∑...' : '–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ...';
      renderInterests(); // Re-render interests to update language
    }

    // ---------- Theme / Lang ----------
    function toggleTheme() {
      const root = document.documentElement;
      const isDark = root.getAttribute('data-theme') === 'dark';
      root.setAttribute('data-theme', isDark ? 'light' : 'dark');
      localStorage.setItem('dhp_theme', isDark ? 'light' : 'dark');
    }

    function toggleLang() {
      lang = (lang === 'kz') ? 'ru' : 'kz';
      applyI18n();
      renderGifts();
      renderMatches();
      updateMe(); // Update profile name/city if needed
      save();
      toast('üåê', lang === 'kz' ? '“ö–∞–∑–∞“õ—à–∞' : '–†—É—Å—Å–∫–∏–π');
    }

    // ---------- Navigation ----------
    function showSection(id) {
      $$('.section').forEach(s => s.classList.remove('active'));
      $('#' + id).classList.add('active');
      $$('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.section === id));
      if (id === 'matches') {
        unreadCount = 0;
        updateBadges();
      }
    }

    // ---------- Browse logic ----------
    function currentProfile() {
      if (!filteredProfiles.length) return null;
      return filteredProfiles[idx % filteredProfiles.length];
    }

    function renderDots(count) {
      const wrap = $('#photoDots');
      wrap.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const d = document.createElement('div');
        d.className = 'dot' + (i === photoIdx ? ' active' : '');
        wrap.appendChild(d);
      }
    }

    function displayProfile() {
      const p = currentProfile();
      if (!p) {
        $('#pName').textContent = '‚Äî';
        $('#pMeta').textContent = 'No profiles';
        $('#pBio').textContent = '';
        $('#pTags').innerHTML = '';
        $('#photoEmoji').textContent = 'ü´•';
        $('#photo').style.background = 'linear-gradient(135deg,#ddd,#bbb)';
        return;
      }

      views++;

      $('#photo').style.background = photoGradients[p.photos[photoIdx] ?? 0];
      $('#photoEmoji').textContent = p.emoji;
      $('#pName').textContent = `${p.name}, ${p.age}`;
      $('#pMeta').innerHTML = `üìç ${p.city} ‚Ä¢ ${p.distance}–∫–º`;
      $('#pBio').textContent = p.bio;

      $('#aiScore').textContent = p.aiScore;
      $('#aiScoreSmall').textContent = p.aiScore + '%';

      $('#verifiedBadge').style.display = p.verified ? '' : 'none';
      $('#onlineBadge').style.display = p.online ? '' : 'none';

      $('#pTags').innerHTML = '';
      p.interests.forEach(x => {
        const el = document.createElement('div');
        el.className = 'tag';
        el.textContent = x;
        $('#pTags').appendChild(el);
      });

      renderDots(p.photos.length);
      updateBadges();
      save();
    }

    function nextPhoto() {
      const p = currentProfile();
      if (!p) return;
      photoIdx = (photoIdx + 1) % p.photos.length;
      displayProfile();
    }

    function prevPhoto() {
      const p = currentProfile();
      if (!p) return;
      photoIdx = (photoIdx - 1 + p.photos.length) % p.photos.length;
      displayProfile();
    }

    function skip() {
      toast('üëã', t('toast_skip'));
      idx++;
      photoIdx = 0;
      displayProfile();
    }

    function superLike() {
      if (starBalance < 5) {
        toast('‚ö†Ô∏è', 'Not enough ‚≠ê');
        return;
      }
      starBalance -= 5;
      likes++;
      toast('‚≠ê', t('toast_super'));
      tryMatch(true);
      idx++;
      photoIdx = 0;
      displayProfile();
    }

    function like() {
      likes++;
      toast('‚ù§Ô∏è', t('toast_like'));
      tryMatch(false);
      idx++;
      photoIdx = 0;
      displayProfile();
    }

    function filterByCity() {
      const city = $('#citySelect').value;
      filteredProfiles = city ? allProfiles.filter(p => p.city === city) : [...allProfiles];
      idx = 0;
      photoIdx = 0;
      displayProfile();
      toast('üîé', city ? `City: ${city}` : t('all_cities'));
    }

    // ---------- Matching + real-time notifications ----------
    function tryMatch(isSuper) {
      const p = currentProfile();
      if (!p) return;

      // probability
      const base = isSuper ? 0.72 : 0.38;
      const chance = Math.min(0.92, base + (p.aiScore / 250));
      const roll = Math.random();

      if (roll <= chance) {
        createMatch(p);
      }
    }

    function createMatch(profile) {
      if (matches.some(m => m.id === profile.id)) return;

      const match = {
        id: profile.id,
        name: profile.name,
        emoji: profile.emoji,
        city: profile.city,
        aiScore: profile.aiScore,
        ts: Date.now()
      };
      matches.unshift(match);
      chats[String(match.id)] = chats[String(match.id)] || [
        { me: false, text: '–°”ô–ª–µ–º! üëã', ts: Date.now() }
      ];

      unreadCount++;
      updateBadges();
      renderMatches();
      save();

      toast('üíò', t('toast_match'));
      pushRealtimeCard(match);
    }

    function pushRealtimeCard(match) {
      const bell = $('#rtBell');
      const card = document.createElement('div');
      card.className = 'rt-card';
      card.innerHTML = `
        <div class="rt-top">
          <div>
            <div class="rt-title">${t('rt_new_match')} üíò</div>
            <div class="rt-sub">${match.emoji} ${match.name} ‚Ä¢ ${match.city} ‚Ä¢ ${match.aiScore}%</div>
          </div>
          <button class="icon-btn" style="width:40px;height:40px;" onclick="this.closest('.rt-card').remove()" aria-label="Close">‚úï</button>
        </div>
        <div class="rt-actions">
          <button class="btn btn-primary" style="flex:1" onclick="openChat(${match.id}); this.closest('.rt-card').remove();">üí¨ ${t('rt_open_chat')}</button>
          <button class="btn btn-ghost" onclick="this.closest('.rt-card').remove();">${t('rt_close')}</button>
        </div>
      `;
      bell.appendChild(card);

      // auto remove after some time
      setTimeout(() => { if (card.isConnected) card.remove(); }, 9000);
    }

    function simulateRealtimeMatch() {
      // pick random profile not matched
      const pool = allProfiles.filter(p => !matches.some(m => m.id === p.id));
      if (!pool.length) {
        toast('‚ÑπÔ∏è', 'No more profiles');
        return;
      }
      const p = pool[Math.floor(Math.random() * pool.length)];
      createMatch(p);
    }

    // ---------- Matches + chat ----------
    function renderMatches() {
      const list = $('#matchesList');
      list.innerHTML = '';

      if (!matches.length) {
        const empty = document.createElement('div');
        empty.className = 'stat';
        empty.innerHTML = `<span style="font-weight:900;">${lang==='kz' ? '–ú–∞—Ç—á –∂–æ“õ' : '–ù–µ—Ç –º–∞—Ç—á–µ–π'}</span><span style="color:var(--text-sub); font-weight:800;">${lang==='kz' ? '–õ–∞–π–∫ –±–∞—Å—ã–ø –∫”©—Ä—ñ“£—ñ–∑' : '–ü–æ—Å—Ç–∞–≤—å—Ç–µ –ª–∞–π–∫'}</span>`;
        list.appendChild(empty);
        return;
      }

      matches.forEach(m => {
        const row = document.createElement('div');
        row.className = 'match';
        row.onclick = () => openChat(m.id);
        row.innerHTML = `
          <div class="avatar" style="background:${photoGradients[m.id % photoGradients.length]}">${m.emoji}</div>
          <div class="match-info">
            <p class="match-name">${m.name}</p>
            <div class="match-sub">üìç ${m.city} ‚Ä¢ ${lang==='kz' ? '–ß–∞—Ç“õ–∞ –∫—ñ—Ä—ñ“£—ñ–∑' : '–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç'}</div>
          </div>
          <div class="compat">${m.aiScore}%</div>
        `;
        list.appendChild(row);
      });
    }

    function openChat(matchId) {
      const m = matches.find(x => x.id === matchId);
      if (!m) return;
      currentChatId = String(matchId);

      $('#chatTitle').textContent = `üí¨ ${m.name}`;
      $('#chatSubtitle').textContent = `${m.emoji} ${m.city} ‚Ä¢ ${m.aiScore}%`;
      renderChat();
      openModal('chatModal');

      // mark read
      unreadCount = Math.max(0, unreadCount - 1);
      updateBadges();
    }

    function renderChat() {
      const log = $('#chatLog');
      log.innerHTML = '';
      const msgs = chats[currentChatId] || [];
      msgs.forEach(msg => {
        const el = document.createElement('div');
        el.className = 'msg ' + (msg.me ? 'me' : 'other');
        el.textContent = msg.text;
        log.appendChild(el);
      });
      log.scrollTop = log.scrollHeight;
    }

    function sendMessage() {
      if (!currentChatId) return;
      const input = $('#chatInput');
      const text = input.value.trim();
      if (!text) return;

      chats[currentChatId] = chats[currentChatId] || [];
      chats[currentChatId].push({ me: true, text, ts: Date.now() });
      input.value = '';
      renderChat();
      save();

      // auto reply
      setTimeout(() => {
        const replies = lang === 'kz'
          ? ['–ö–µ—Ä–µ–º–µ—Ç üòÑ', '“ö—ã–∑—ã“õ –µ–∫–µ–Ω!', '“ö–∞–π–¥–∞ –∫–µ–∑–¥–µ—Å–µ–º—ñ–∑? ‚òï', '–°–µ–Ω—ñ“£ —Ö–æ–±–±–∏—ñ“£ “õ–∞–Ω–¥–∞–π?']
          : ['–ö—Ä—É—Ç–æ üòÑ', '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ!', '–ì–¥–µ –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è? ‚òï', '–ö–∞–∫–∏–µ —É —Ç–µ–±—è —Ö–æ–±–±–∏?'];
        const r = replies[Math.floor(Math.random()*replies.length)];
        chats[currentChatId].push({ me: false, text: r, ts: Date.now() });
        renderChat();
        save();
      }, 650);
    }

    // ---------- Gifts & Animation ----------
    function renderGifts() {
      const grid = $('#giftsGrid');
      const modalGrid = $('#giftModalGrid');
      grid.innerHTML = '';
      modalGrid.innerHTML = '';

      gifts.forEach((g, i) => {
        const name = lang === 'kz' ? g.nameKz : g.nameRu;
        const card = document.createElement('div');
        card.className = 'gift';
        card.innerHTML = `
          <span class="gift-emoji">${g.emoji}</span>
          <p class="gift-name">${name}</p>
          <span class="gift-cost">‚≠ê ${g.cost}</span>
        `;
        card.onclick = () => { giftTarget = currentProfile(); openGiftModal(); };
        grid.appendChild(card);

        const card2 = card.cloneNode(true);
        card2.onclick = () => buyGift(i);
        modalGrid.appendChild(card2);
      });
    }

    function openGiftModal() {
      giftTarget = giftTarget || currentProfile();
      if (!giftTarget) return;
      openModal('giftModal');
    }

    function buyGift(giftIndex) {
      const g = gifts[giftIndex];
      if (!giftTarget) return;

      if (starBalance < g.cost) {
        toast('‚ö†Ô∏è', 'Not enough ‚≠ê');
        return;
      }
      starBalance -= g.cost;
      updateBadges();
      save();

      // Close modal FIRST so animation is visible clearly
      closeModal('giftModal');

      // Trigger beautiful animation
      triggerGiftAnimation(g.emoji);

      toast('üéÅ', t('toast_gift'));

      // chance to match
      if (Math.random() < 0.55) {
        createMatch(giftTarget);
      }
    }

    function triggerGiftAnimation(emoji) {
      // Container
      const container = document.createElement('div');
      container.className = 'gift-anim-container';
      
      // Main BIG emoji
      const main = document.createElement('div');
      main.textContent = emoji;
      main.className = 'gift-anim-main';
      container.appendChild(main);

      // Particles
      const particles = ['‚ú®', '‚≠ê', 'üíñ', 'üí•'];
      for (let i = 0; i < 12; i++) {
        const p = document.createElement('div');
        p.textContent = particles[Math.floor(Math.random() * particles.length)];
        p.className = 'gift-particle';
        
        // Random physics
        const angle = Math.random() * Math.PI * 2;
        const dist = 100 + Math.random() * 150;
        const tx = Math.cos(angle) * dist;
        const ty = Math.sin(angle) * dist;
        
        p.style.setProperty('--tx', `${tx}px`);
        p.style.setProperty('--ty', `${ty}px`);
        // Randomize delay slightly
        p.style.animationDelay = (Math.random() * 0.2) + 's';
        
        container.appendChild(p);
      }

      document.body.appendChild(container);

      // Cleanup
      setTimeout(() => {
        if(container.isConnected) container.remove();
      }, 2000);
    }
    
    // ---------- Interests & Photo Logic ----------
    function renderInterests() {
      const container = $('#interestContainer');
      container.innerHTML = '';
      
      interestCategories.forEach(key => {
        const label = t(key);
        const el = document.createElement('div');
        el.className = 'interest-tag' + (myInterests.includes(key) ? ' selected' : '');
        el.textContent = label;
        el.onclick = () => toggleInterest(key);
        container.appendChild(el);
      });
    }
    
    function toggleInterest(key) {
      if (myInterests.includes(key)) {
        myInterests = myInterests.filter(k => k !== key);
      } else {
        myInterests.push(key);
      }
      renderInterests();
    }
    
    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(evt) {
        myPhoto = evt.target.result;
        updatePhotoPreview(myPhoto);
        toast('üì∑', 'OK');
      };
      reader.readAsDataURL(file);
    }
    
    function updatePhotoPreview(src) {
      const preview = $('#photoPreview');
      const meAvatar = $('#meAvatar');
      
      if (src) {
        preview.style.display = 'block';
        preview.style.backgroundImage = `url(${src})`;
        
        meAvatar.textContent = '';
        meAvatar.style.backgroundImage = `url(${src})`;
      } else {
        preview.style.display = 'none';
        meAvatar.textContent = 'üë§';
        meAvatar.style.backgroundImage = 'none';
      }
    }

    // ---------- Profile form validation + verification ----------
    function setInvalid(input, errEl, on) {
      if (on) {
        input.classList.add('invalid');
        errEl.style.display = 'block';
      } else {
        input.classList.remove('invalid');
        errEl.style.display = 'none';
      }
    }

    function validateForm() {
      const name = $('#inpName');
      const city = $('#inpCity');
      const email = $('#inpEmail');
      const age = $('#inpAge');

      const errName = $('#errName');
      const errCity = $('#errCity');
      const errEmail = $('#errEmail');
      const errAge = $('#errAge');

      let ok = true;

      const vName = name.value.trim();
      const nameOk = vName.length >= 2 && vName.length <= 20;
      setInvalid(name, errName, !nameOk);
      ok = ok && nameOk;

      const cityOk = !!city.value;
      setInvalid(city, errCity, !cityOk);
      ok = ok && cityOk;

      const vEmail = email.value.trim();
      const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(vEmail);
      setInvalid(email, errEmail, !emailOk);
      ok = ok && emailOk;

      const vAge = parseInt(age.value, 10);
      const ageOk = Number.isFinite(vAge) && vAge >= 18 && vAge <= 80;
      setInvalid(age, errAge, !ageOk);
      ok = ok && ageOk;

      return ok;
    }

    function updateMe() {
      const n = $('#inpName').value.trim() || 'User';
      const c = $('#inpCity').value || '‚Äî';
      $('#meName').textContent = n;
      $('#meCity').textContent = c;
      $('#verificationStatus').textContent = isVerified ? (lang==='kz' ? '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚úì' : '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚úì') : (lang==='kz' ? '–ñ–æ“õ' : '–ù–µ—Ç');
      $('#verifiedSmall').textContent = isVerified ? '‚úì' : '‚Äî';
    }

    function verifyProfile() {
      // demo: instant verification
      isVerified = true;
      updateMe();
      updateBadges();
      save();
      toast('üì∏', t('toast_verified'));
    }

    // ---------- Online sidebar ----------
    function renderOnline() {
      const list = $('#onlineList');
      list.innerHTML = '';
      const online = allProfiles.filter(p => p.online).slice(0, 6);
      online.forEach(p => {
        const el = document.createElement('div');
        el.className = 'mini';
        el.onclick = () => {
          // jump to this profile
          const inFiltered = filteredProfiles.findIndex(x => x.id === p.id);
          if (inFiltered >= 0) idx = inFiltered;
          else {
            filteredProfiles = [...allProfiles];
            idx = allProfiles.findIndex(x => x.id === p.id);
            $('#citySelect').value = '';
          }
          photoIdx = 0;
          showSection('browse');
          displayProfile();
          toast('üü¢', `${p.name} online`);
        };
        el.innerHTML = `
          <div class="avatar" style="background:${photoGradients[p.id % photoGradients.length]}">${p.emoji}</div>
          <div style="min-width:0;">
            <div class="mname">${p.name}</div>
            <div class="mmeta">üìç ${p.city} ‚Ä¢ ${p.aiScore}%</div>
          </div>
        `;
        list.appendChild(el);
      });
    }

    // ---------- Modals ----------
    function openModal(id) {
      $('#' + id).classList.add('active');
    }
    function closeModal(id) {
      $('#' + id).classList.remove('active');
    }
    function modalBackdropClose(e, id) {
      if (e.target.id === id) closeModal(id);
    }

    // ---------- Init ----------
    function init() {
      // theme
      const theme = localStorage.getItem('dhp_theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);

      // default lang
      document.documentElement.setAttribute('data-lang', lang);

      // shuffle
      shuffle(allProfiles);
      filteredProfiles = [...allProfiles];

      // dots
      renderDots(4);

      // render
      renderOnline();
      renderGifts();
      renderMatches();
      displayProfile();

      // profile form
      load();
      updateMe();
      updateBadges();
      applyI18n(); // this will also renderInterests

      // set verified badge text
      $('#verifiedSmall').textContent = isVerified ? '‚úì' : '‚Äî';

      // form events
      $('#profileForm').addEventListener('submit', (e) => {
        e.preventDefault();
        if (!validateForm()) {
          toast('‚ö†Ô∏è', lang==='kz' ? '–§–æ—Ä–º–∞ “õ–∞—Ç–µ —Ç–æ–ª—Ç—ã—Ä—ã–ª“ì–∞–Ω' : '–§–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –Ω–µ–≤–µ—Ä–Ω–æ');
          return;
        }
        updateMe();
        save();
        toast('üíæ', t('toast_saved'));
      });

      ['#inpName','#inpCity','#inpEmail','#inpAge'].forEach(sel => {
        $(sel).addEventListener('input', () => {
          validateForm();
        });
        $(sel).addEventListener('change', () => {
          validateForm();
        });
      });

      // keyboard send
      $('#chatInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendMessage();
        }
      });

      // show verification status
      $('#verificationStatus').textContent = isVerified ? '‚úì' : '‚Äî';
    }

    // Expose some functions to window
    window.toggleTheme = toggleTheme;
    window.toggleLang = toggleLang;
    window.showSection = showSection;
    window.filterByCity = filterByCity;
    window.nextPhoto = nextPhoto;
    window.prevPhoto = prevPhoto;
    window.like = like;
    window.skip = skip;
    window.superLike = superLike;
    window.openGiftModal = openGiftModal;
    window.closeModal = closeModal;
    window.modalBackdropClose = modalBackdropClose;
    window.buyGift = buyGift;
    window.openChat = openChat;
    window.sendMessage = sendMessage;
    window.verifyProfile = verifyProfile;
    window.simulateRealtimeMatch = simulateRealtimeMatch;
    window.handleFileSelect = handleFileSelect;
    window.toggleInterest = toggleInterest;

    init();
  </script>
</body>
</html>